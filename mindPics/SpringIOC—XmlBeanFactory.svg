<svg ed:hSpacing="30" ed:vSpacing="30" height="1831" width="1673" ed:name="Page-1" viewBox="0 0 1673 1831" xmlns:ed="http://www.edrawsoft.cn/xml/2017/SVGExtensions/" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="page100" xmlns:ev="http://www.w3.org/2001/xml-events"><style type="text/css"><![CDATA[
g[ed\:togtopicid],g[ed\:hyperlink],g[ed\:comment],g[ed\:note] {cursor:pointer;}
g[id] {-moz-user-select: none;-ms-user-select: none;user-select: none;}
svg text::selection,svg tspan::selection{background-color: #4285f4;color: #ffffff;fill: #ffffff;}
.st1 {fill:#000000;font-family:微软雅黑;font-size:9pt}
.st5 {fill:#303030;font-family:微软雅黑;font-size:11pt}
.st2 {fill:#303030;font-family:微软雅黑;font-size:14pt}
.st3 {fill:#303030;font-family:微软雅黑;font-size:9pt}
.st8 {fill:#303030;font-weight:normal}
.st6 {fill:#f96628;font-family:微软雅黑;font-size:9pt;font-weight:bold}
.st4 {fill:#f96628;font-weight:bold;text-decoration:underline}
.st7 {text-decoration:underline}
]]></style><defs><linearGradient x1="0%" x2="0%" y2="100%" id="lg1" y1="0%"><stop offset="0" stop-color="#ffffff"/><stop offset="0.25" stop-color="#f0f5f0"/><stop offset="0.75" stop-color="#e1ebe1"/><stop offset="1" stop-color="#c8d7c8"/></linearGradient></defs><rect x="0" height="1831" width="1673" fill="#ffffff" y="0"/><g ed:toid="210" ed:type="relation" ed:fromid="177" id="214" transform="matrix(1,0,0,1,565,1270)"><path d="M313.5,-203.5C-979.5,-45.5,14.5,-92.5,-313.5,203.5" fill="none"/><path stroke="#96cdde" d="M313.5,-203.5C-973.7,-46.2,5.7,-92.1,-309.2,199.6" fill="none" stroke-linecap="round" stroke-linejoin="round"/><path stroke="#96cdde" d="M-313.5,203.5L-305.7,201.8C-307,201.4,-308.2,200.6,-309.2,199.5C-310.2,198.5,-310.8,197.2,-311.1,195.9L-313.5,203.5" fill="#96cdde" stroke-linecap="round" stroke-width="1"/><rect x="-386.9" height="17" width="48" fill="#ffffff" y="-60.3"/><text class="st1"><tspan x="-386" y="-48.3" style="white-space:pre">具体流程</tspan></text></g><path stroke="#96cdde" d="M-13.5,118.5L3.7,118.5L3.7,-112.5C3.7,-115.8,6.4,-118.5,9.7,-118.5L13.5,-118.5" fill="none" ed:parentid="175" stroke-linecap="round" ed:tosuperid="102" stroke-linejoin="round" id="103" transform="matrix(1,0,0,1,340,218)"/><path stroke="#96cdde" d="M3.7,68.8L3.7,-62.8C3.7,-66.1,6.4,-68.8,9.7,-68.8L13.5,-68.8" fill="none" ed:parentid="175" stroke-linecap="round" ed:tosuperid="104" stroke-linejoin="round" id="105" transform="matrix(1,0,0,1,340,268)"/><path stroke="#96cdde" d="M-13.5,0L3.7,0C3.7,0,6.4,0,9.7,0L13.5,0" fill="none" ed:parentid="102" stroke-linecap="round" ed:tosuperid="108" stroke-linejoin="round" id="109" transform="matrix(1,0,0,1,573,100)"/><path stroke="#96cdde" d="M-13.5,36L3.7,36L3.7,-30C3.7,-33.3,6.4,-36,9.7,-36L13.5,-36" fill="none" ed:parentid="104" stroke-linecap="round" ed:tosuperid="110" stroke-linejoin="round" id="111" transform="matrix(1,0,0,1,610,163)"/><path stroke="#96cdde" d="M3.7,18L3.7,-12C3.7,-15.3,6.4,-18,9.7,-18L13.5,-18" fill="none" ed:parentid="104" stroke-linecap="round" ed:tosuperid="112" stroke-linejoin="round" id="113" transform="matrix(1,0,0,1,610,181)"/><path stroke="#96cdde" d="M3.7,0C3.7,0,6.4,0,9.7,0L13.5,0" fill="none" ed:parentid="104" stroke-linecap="round" ed:tosuperid="114" stroke-linejoin="round" id="115" transform="matrix(1,0,0,1,610,199)"/><path stroke="#96cdde" d="M3.7,-13.8L3.7,7.8C3.7,11.1,6.4,13.8,9.7,13.8L13.5,13.8" fill="none" ed:parentid="104" stroke-linecap="round" ed:tosuperid="118" stroke-linejoin="round" id="119" transform="matrix(1,0,0,1,610,213)"/><path stroke="#96cdde" d="M3.7,-31.8L3.7,25.8C3.7,29.1,6.4,31.8,9.7,31.8L13.5,31.8" fill="none" ed:parentid="104" stroke-linecap="round" ed:tosuperid="120" stroke-linejoin="round" id="121" transform="matrix(1,0,0,1,610,231)"/><path stroke="#96cdde" d="M3.7,-1.6C3.7,0.2,6.4,1.6,9.7,1.6L13.5,1.6" fill="none" ed:parentid="175" stroke-linecap="round" ed:tosuperid="122" stroke-linejoin="round" id="123" transform="matrix(1,0,0,1,340,338)"/><path stroke="#96cdde" d="M3.7,-6.9L3.7,0.9C3.7,4.2,6.4,6.9,9.7,6.9L13.5,6.9" fill="none" ed:parentid="122" stroke-linecap="round" ed:tosuperid="124" stroke-linejoin="round" id="125" transform="matrix(1,0,0,1,629,347)"/><path stroke="#96cdde" d="M-13.5,13.8L3.7,13.8L3.7,-7.8C3.7,-11.1,6.4,-13.8,9.7,-13.8L13.5,-13.8" fill="none" ed:parentid="122" stroke-linecap="round" ed:tosuperid="126" stroke-linejoin="round" id="127" transform="matrix(1,0,0,1,629,326)"/><path stroke="#96cdde" d="M-13.5,6.9L3.7,6.9L3.7,-0.9C3.7,-4.2,6.4,-6.9,9.7,-6.9L13.5,-6.9" fill="none" ed:parentid="126" stroke-linecap="round" ed:tosuperid="128" stroke-linejoin="round" id="129" transform="matrix(1,0,0,1,1060,305)"/><path stroke="#96cdde" d="M3.7,-6.9L3.7,0.9C3.7,4.2,6.4,6.9,9.7,6.9L13.5,6.9" fill="none" ed:parentid="126" stroke-linecap="round" ed:tosuperid="130" stroke-linejoin="round" id="131" transform="matrix(1,0,0,1,1060,319)"/><path stroke="#96cdde" d="M3.7,-20.6L3.7,14.6C3.7,17.9,6.4,20.6,9.7,20.6L13.5,20.6" fill="none" ed:parentid="122" stroke-linecap="round" ed:tosuperid="132" stroke-linejoin="round" id="133" transform="matrix(1,0,0,1,629,360)"/><path stroke="#96cdde" d="M3.7,-77.3L3.7,71.3C3.7,74.6,6.4,77.3,9.7,77.3L13.5,77.3" fill="none" ed:parentid="175" stroke-linecap="round" ed:tosuperid="134" stroke-linejoin="round" id="135" transform="matrix(1,0,0,1,340,414)"/><path stroke="#96cdde" d="M-13.5,41.3L3.7,41.3L3.7,-35.3C3.7,-38.6,6.4,-41.3,9.7,-41.3L13.5,-41.3" fill="none" ed:parentid="134" stroke-linecap="round" ed:tosuperid="136" stroke-linejoin="round" id="137" transform="matrix(1,0,0,1,621,450)"/><path stroke="#96cdde" d="M3.7,27.5L3.7,-21.5C3.7,-24.8,6.4,-27.5,9.7,-27.5L13.5,-27.5" fill="none" ed:parentid="134" stroke-linecap="round" ed:tosuperid="138" stroke-linejoin="round" id="139" transform="matrix(1,0,0,1,621,464)"/><path stroke="#96cdde" d="M3.7,13.8L3.7,-7.8C3.7,-11.1,6.4,-13.8,9.7,-13.8L13.5,-13.8" fill="none" ed:parentid="134" stroke-linecap="round" ed:tosuperid="140" stroke-linejoin="round" id="141" transform="matrix(1,0,0,1,621,477)"/><path stroke="#96cdde" d="M3.7,-20.6L3.7,14.6C3.7,17.9,6.4,20.6,9.7,20.6L13.5,20.6" fill="none" ed:parentid="134" stroke-linecap="round" ed:tosuperid="142" stroke-linejoin="round" id="143" transform="matrix(1,0,0,1,621,512)"/><path stroke="#96cdde" d="M-13.5,20.6L3.7,20.6L3.7,-14.6C3.7,-17.9,6.4,-20.6,9.7,-20.6L13.5,-20.6" fill="none" ed:parentid="142" stroke-linecap="round" ed:tosuperid="144" stroke-linejoin="round" id="145" transform="matrix(1,0,0,1,999,512)"/><path stroke="#96cdde" d="M3.7,6.9L3.7,-0.9C3.7,-4.2,6.4,-6.9,9.7,-6.9L13.5,-6.9" fill="none" ed:parentid="142" stroke-linecap="round" ed:tosuperid="146" stroke-linejoin="round" id="147" transform="matrix(1,0,0,1,999,525)"/><path stroke="#96cdde" d="M3.7,-20.6L3.7,14.6C3.7,17.9,6.4,20.6,9.7,20.6L13.5,20.6" fill="none" ed:parentid="142" stroke-linecap="round" ed:tosuperid="148" stroke-linejoin="round" id="149" transform="matrix(1,0,0,1,999,553)"/><path stroke="#96cdde" d="M3.7,-6.9L3.7,0.9C3.7,4.2,6.4,6.9,9.7,6.9L13.5,6.9" fill="none" ed:parentid="142" stroke-linecap="round" ed:tosuperid="150" stroke-linejoin="round" id="151" transform="matrix(1,0,0,1,999,539)"/><path stroke="#96cdde" d="M0,-248.1L0,248.1" fill="none" ed:parentid="101" stroke-linecap="round" ed:tosuperid="155" stroke-linejoin="round" id="156" transform="matrix(1,0,0,1,174,603)"/><path stroke="#96cdde" d="M-13.5,130.6L3.7,130.6L3.7,-124.6C3.7,-127.9,6.4,-130.6,9.7,-130.6L13.5,-130.6" fill="none" ed:parentid="155" stroke-linecap="round" ed:tosuperid="157" stroke-linejoin="round" id="158" transform="matrix(1,0,0,1,283,738)"/><path stroke="#96cdde" d="M3.7,96.3L3.7,-90.3C3.7,-93.6,6.4,-96.3,9.7,-96.3L13.5,-96.3" fill="none" ed:parentid="155" stroke-linecap="round" ed:tosuperid="159" stroke-linejoin="round" id="160" transform="matrix(1,0,0,1,283,773)"/><path stroke="#96cdde" d="M3.7,27.5L3.7,-21.5C3.7,-24.8,6.4,-27.5,9.7,-27.5L13.5,-27.5" fill="none" ed:parentid="155" stroke-linecap="round" ed:tosuperid="161" stroke-linejoin="round" id="162" transform="matrix(1,0,0,1,283,841)"/><path stroke="#96cdde" d="M3.7,-75.6L3.7,69.6C3.7,72.9,6.4,75.6,9.7,75.6L13.5,75.6" fill="none" ed:parentid="155" stroke-linecap="round" ed:tosuperid="163" stroke-linejoin="round" id="164" transform="matrix(1,0,0,1,283,944)"/><path stroke="#96cdde" d="M-13.5,55L3.7,55L3.7,-49C3.7,-52.3,6.4,-55,9.7,-55L13.5,-55" fill="none" ed:parentid="163" stroke-linecap="round" ed:tosuperid="165" stroke-linejoin="round" id="166" transform="matrix(1,0,0,1,597,965)"/><path stroke="#96cdde" d="M3.7,41.3L3.7,-35.3C3.7,-38.6,6.4,-41.3,9.7,-41.3L13.5,-41.3" fill="none" ed:parentid="163" stroke-linecap="round" ed:tosuperid="167" stroke-linejoin="round" id="168" transform="matrix(1,0,0,1,597,979)"/><path stroke="#96cdde" d="M3.7,-13.8L3.7,7.8C3.7,11.1,6.4,13.8,9.7,13.8L13.5,13.8" fill="none" ed:parentid="163" stroke-linecap="round" ed:tosuperid="169" stroke-linejoin="round" id="170" transform="matrix(1,0,0,1,597,1034)"/><path stroke="#96cdde" d="M-13.5,41.3L3.7,41.3L3.7,-35.3C3.7,-38.6,6.4,-41.3,9.7,-41.3L13.5,-41.3" fill="none" ed:parentid="169" stroke-linecap="round" ed:tosuperid="171" stroke-linejoin="round" id="172" transform="matrix(1,0,0,1,849,1006)"/><path stroke="#96cdde" d="M3.7,27.5L3.7,-21.5C3.7,-24.8,6.4,-27.5,9.7,-27.5L13.5,-27.5" fill="none" ed:parentid="169" stroke-linecap="round" ed:tosuperid="173" stroke-linejoin="round" id="174" transform="matrix(1,0,0,1,849,1020)"/><path stroke="#96cdde" d="M0,-121.3L0,121.3" fill="none" ed:parentid="101" stroke-linecap="round" ed:tosuperid="175" stroke-linejoin="round" id="176" transform="matrix(1,0,0,1,174,197)"/><path stroke="#96cdde" d="M3.7,0C3.7,0,6.4,0,9.7,0L13.5,0" fill="none" ed:parentid="169" stroke-linecap="round" ed:tosuperid="177" stroke-linejoin="round" id="178" transform="matrix(1,0,0,1,849,1048)"/><path stroke="#96cdde" d="M3.7,-41.3L3.7,35.3C3.7,38.6,6.4,41.3,9.7,41.3L13.5,41.3" fill="none" ed:parentid="169" stroke-linecap="round" ed:tosuperid="179" stroke-linejoin="round" id="180" transform="matrix(1,0,0,1,849,1089)"/><path stroke="#96cdde" d="M-13.5,20.6L3.7,20.6L3.7,-14.6C3.7,-17.9,6.4,-20.6,9.7,-20.6L13.5,-20.6" fill="none" ed:parentid="159" stroke-linecap="round" ed:tosuperid="181" stroke-linejoin="round" id="182" transform="matrix(1,0,0,1,617,656)"/><path stroke="#96cdde" d="M3.7,6.9L3.7,-0.9C3.7,-4.2,6.4,-6.9,9.7,-6.9L13.5,-6.9" fill="none" ed:parentid="159" stroke-linecap="round" ed:tosuperid="183" stroke-linejoin="round" id="184" transform="matrix(1,0,0,1,617,669)"/><path stroke="#96cdde" d="M3.7,-6.9L3.7,0.9C3.7,4.2,6.4,6.9,9.7,6.9L13.5,6.9" fill="none" ed:parentid="159" stroke-linecap="round" ed:tosuperid="185" stroke-linejoin="round" id="186" transform="matrix(1,0,0,1,617,683)"/><path stroke="#96cdde" d="M3.7,-20.6L3.7,14.6C3.7,17.9,6.4,20.6,9.7,20.6L13.5,20.6" fill="none" ed:parentid="159" stroke-linecap="round" ed:tosuperid="187" stroke-linejoin="round" id="188" transform="matrix(1,0,0,1,617,697)"/><path stroke="#96cdde" d="M-13.5,34.4L3.7,34.4L3.7,-28.4C3.7,-31.7,6.4,-34.4,9.7,-34.4L13.5,-34.4" fill="none" ed:parentid="161" stroke-linecap="round" ed:tosuperid="189" stroke-linejoin="round" id="190" transform="matrix(1,0,0,1,789,779)"/><path stroke="#96cdde" d="M3.7,20.6L3.7,-14.6C3.7,-17.9,6.4,-20.6,9.7,-20.6L13.5,-20.6" fill="none" ed:parentid="161" stroke-linecap="round" ed:tosuperid="191" stroke-linejoin="round" id="192" transform="matrix(1,0,0,1,789,793)"/><path stroke="#96cdde" d="M3.7,-13.8L3.7,7.8C3.7,11.1,6.4,13.8,9.7,13.8L13.5,13.8" fill="none" ed:parentid="161" stroke-linecap="round" ed:tosuperid="193" stroke-linejoin="round" id="194" transform="matrix(1,0,0,1,789,828)"/><path stroke="#96cdde" d="M-13.5,20.6L3.7,20.6L3.7,-14.6C3.7,-17.9,6.4,-20.6,9.7,-20.6L13.5,-20.6" fill="none" ed:parentid="193" stroke-linecap="round" ed:tosuperid="195" stroke-linejoin="round" id="196" transform="matrix(1,0,0,1,1189,821)"/><path stroke="#96cdde" d="M3.7,6.9L3.7,-0.9C3.7,-4.2,6.4,-6.9,9.7,-6.9L13.5,-6.9" fill="none" ed:parentid="193" stroke-linecap="round" ed:tosuperid="197" stroke-linejoin="round" id="198" transform="matrix(1,0,0,1,1189,834)"/><path stroke="#96cdde" d="M3.7,-20.6L3.7,14.6C3.7,17.9,6.4,20.6,9.7,20.6L13.5,20.6" fill="none" ed:parentid="193" stroke-linecap="round" ed:tosuperid="199" stroke-linejoin="round" id="200" transform="matrix(1,0,0,1,1189,862)"/><path stroke="#96cdde" d="M3.7,-6.9L3.7,0.9C3.7,4.2,6.4,6.9,9.7,6.9L13.5,6.9" fill="none" ed:parentid="193" stroke-linecap="round" ed:tosuperid="202" stroke-linejoin="round" id="203" transform="matrix(1,0,0,1,1189,848)"/><path stroke="#96cdde" d="M-13.5,13.8L3.7,13.8L3.7,-7.8C3.7,-11.1,6.4,-13.8,9.7,-13.8L13.5,-13.8" fill="none" ed:parentid="177" stroke-linecap="round" ed:tosuperid="204" stroke-linejoin="round" id="205" transform="matrix(1,0,0,1,1220,1034)"/><path stroke="#96cdde" d="M3.7,0C3.7,0,6.4,0,9.7,0L13.5,0" fill="none" ed:parentid="177" stroke-linecap="round" ed:tosuperid="206" stroke-linejoin="round" id="207" transform="matrix(1,0,0,1,1220,1048)"/><path stroke="#96cdde" d="M3.7,-13.8L3.7,7.8C3.7,11.1,6.4,13.8,9.7,13.8L13.5,13.8" fill="none" ed:parentid="177" stroke-linecap="round" ed:tosuperid="208" stroke-linejoin="round" id="209" transform="matrix(1,0,0,1,1220,1061)"/><path stroke="#96cdde" d="M-13.5,131.8L3.7,131.8L3.7,-125.8C3.7,-129.1,6.4,-131.8,9.7,-131.8L13.5,-131.8" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="211" stroke-linejoin="round" id="212" transform="matrix(1,0,0,1,603,1415)"/><path stroke="#96cdde" d="M3.7,95.5L3.7,-89.5C3.7,-92.8,6.4,-95.5,9.7,-95.5L13.5,-95.5" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="215" stroke-linejoin="round" id="216" transform="matrix(1,0,0,1,603,1451)"/><path stroke="#96cdde" d="M-13.5,21.8L3.7,21.8L3.7,-15.8C3.7,-19.1,6.4,-21.8,9.7,-21.8L13.5,-21.8" fill="none" ed:parentid="215" stroke-linecap="round" ed:tosuperid="219" stroke-linejoin="round" id="220" transform="matrix(1,0,0,1,1130,1334)"/><path stroke="#96cdde" d="M3.7,7.3L3.7,-1.3C3.7,-4.6,6.4,-7.3,9.7,-7.3L13.5,-7.3" fill="none" ed:parentid="215" stroke-linecap="round" ed:tosuperid="221" stroke-linejoin="round" id="222" transform="matrix(1,0,0,1,1130,1348)"/><path stroke="#96cdde" d="M-13.5,147.9L3.7,147.9L3.7,-141.9C3.7,-145.2,6.4,-147.9,9.7,-147.9L13.5,-147.9" fill="none" ed:parentid="210" stroke-linecap="round" ed:tosuperid="223" stroke-linejoin="round" id="224" transform="matrix(1,0,0,1,390,1344)"/><path stroke="#96cdde" d="M3.7,133.4L3.7,-127.4C3.7,-130.7,6.4,-133.4,9.7,-133.4L13.5,-133.4" fill="none" ed:parentid="210" stroke-linecap="round" ed:tosuperid="225" stroke-linejoin="round" id="226" transform="matrix(1,0,0,1,390,1358)"/><path stroke="#96cdde" d="M3.7,118.9L3.7,-112.9C3.7,-116.2,6.4,-118.9,9.7,-118.9L13.5,-118.9" fill="none" ed:parentid="210" stroke-linecap="round" ed:tosuperid="231" stroke-linejoin="round" id="232" transform="matrix(1,0,0,1,390,1373)"/><path stroke="#96cdde" d="M3.7,-27.4L3.7,21.4C3.7,24.7,6.4,27.4,9.7,27.4L13.5,27.4" fill="none" ed:parentid="210" stroke-linecap="round" ed:tosuperid="233" stroke-linejoin="round" id="234" transform="matrix(1,0,0,1,390,1519)"/><path stroke="#96cdde" d="M3.7,59.3L3.7,-53.3C3.7,-56.6,6.4,-59.3,9.7,-59.3L13.5,-59.3" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="235" stroke-linejoin="round" id="236" transform="matrix(1,0,0,1,603,1487)"/><path stroke="#96cdde" d="M3.7,44.8L3.7,-38.8C3.7,-42.1,6.4,-44.8,9.7,-44.8L13.5,-44.8" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="237" stroke-linejoin="round" id="238" transform="matrix(1,0,0,1,603,1502)"/><path stroke="#96cdde" d="M3.7,0C3.7,0,6.4,0,9.7,0L13.5,0" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="239" stroke-linejoin="round" id="240" transform="matrix(1,0,0,1,603,1546)"/><path stroke="#96cdde" d="M3.7,-102.8L3.7,96.8C3.7,100.1,6.4,102.8,9.7,102.8L13.5,102.8" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="241" stroke-linejoin="round" id="242" transform="matrix(1,0,0,1,603,1649)"/><path stroke="#96cdde" d="M3.7,-117.3L3.7,111.3C3.7,114.6,6.4,117.3,9.7,117.3L13.5,117.3" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="243" stroke-linejoin="round" id="244" transform="matrix(1,0,0,1,603,1664)"/><path stroke="#96cdde" d="M3.7,-131.8L3.7,125.8C3.7,129.1,6.4,131.8,9.7,131.8L13.5,131.8" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="246" stroke-linejoin="round" id="247" transform="matrix(1,0,0,1,603,1678)"/><path stroke="#96cdde" d="M3.7,-7.3L3.7,1.3C3.7,4.6,6.4,7.3,9.7,7.3L13.5,7.3" fill="none" ed:parentid="215" stroke-linecap="round" ed:tosuperid="248" stroke-linejoin="round" id="249" transform="matrix(1,0,0,1,1130,1363)"/><path stroke="#96cdde" d="M3.7,-21.8L3.7,15.8C3.7,19.1,6.4,21.8,9.7,21.8L13.5,21.8" fill="none" ed:parentid="215" stroke-linecap="round" ed:tosuperid="250" stroke-linejoin="round" id="251" transform="matrix(1,0,0,1,1130,1377)"/><path stroke="#96cdde" d="M3.7,-66.5L3.7,60.5C3.7,63.8,6.4,66.5,9.7,66.5L13.5,66.5" fill="none" ed:parentid="233" stroke-linecap="round" ed:tosuperid="252" stroke-linejoin="round" id="253" transform="matrix(1,0,0,1,603,1613)"/><path stroke="#96cdde" d="M-13.5,30.3L3.7,30.3L3.7,-24.3C3.7,-27.6,6.4,-30.3,9.7,-30.3L13.5,-30.3" fill="none" ed:parentid="239" stroke-linecap="round" ed:tosuperid="254" stroke-linejoin="round" id="255" transform="matrix(1,0,0,1,1078,1516)"/><path stroke="#96cdde" d="M3.7,7.3L3.7,-1.3C3.7,-4.6,6.4,-7.3,9.7,-7.3L13.5,-7.3" fill="none" ed:parentid="239" stroke-linecap="round" ed:tosuperid="256" stroke-linejoin="round" id="257" transform="matrix(1,0,0,1,1078,1539)"/><path stroke="#96cdde" d="M3.7,-15.8L3.7,9.8C3.7,13.1,6.4,15.8,9.7,15.8L13.5,15.8" fill="none" ed:parentid="239" stroke-linecap="round" ed:tosuperid="258" stroke-linejoin="round" id="259" transform="matrix(1,0,0,1,1078,1562)"/><path stroke="#96cdde" d="M3.7,-30.3L3.7,24.3C3.7,27.6,6.4,30.3,9.7,30.3L13.5,30.3" fill="none" ed:parentid="239" stroke-linecap="round" ed:tosuperid="260" stroke-linejoin="round" id="261" transform="matrix(1,0,0,1,1078,1577)"/><path stroke="#96cdde" d="M-13.5,21.8L3.7,21.8L3.7,-15.8C3.7,-19.1,6.4,-21.8,9.7,-21.8L13.5,-21.8" fill="none" ed:parentid="252" stroke-linecap="round" ed:tosuperid="262" stroke-linejoin="round" id="263" transform="matrix(1,0,0,1,1109,1658)"/><path stroke="#96cdde" d="M3.7,7.3L3.7,-1.3C3.7,-4.6,6.4,-7.3,9.7,-7.3L13.5,-7.3" fill="none" ed:parentid="252" stroke-linecap="round" ed:tosuperid="264" stroke-linejoin="round" id="265" transform="matrix(1,0,0,1,1109,1672)"/><path stroke="#96cdde" d="M3.7,-7.3L3.7,1.3C3.7,4.6,6.4,7.3,9.7,7.3L13.5,7.3" fill="none" ed:parentid="252" stroke-linecap="round" ed:tosuperid="266" stroke-linejoin="round" id="267" transform="matrix(1,0,0,1,1109,1687)"/><path stroke="#96cdde" d="M3.7,-21.8L3.7,15.8C3.7,19.1,6.4,21.8,9.7,21.8L13.5,21.8" fill="none" ed:parentid="252" stroke-linecap="round" ed:tosuperid="268" stroke-linejoin="round" id="269" transform="matrix(1,0,0,1,1109,1701)"/><path stroke="#96cdde" d="M3.7,-27.5L3.7,21.5C3.7,24.8,6.4,27.5,9.7,27.5L13.5,27.5" fill="none" ed:parentid="169" stroke-linecap="round" ed:tosuperid="270" stroke-linejoin="round" id="271" transform="matrix(1,0,0,1,849,1075)"/><g ed:topictype="mainidea" ed:width="305" ed:height="55" ed:layout="map" id="101" transform="matrix(1,0,0,1,21,21)"><path stroke="#96cdde" d="M0,0L305,0L305,55L0,55L0,0z" fill="#96cdde" stroke-linejoin="round"/><text class="st2"><tspan x="20" y="33.5" style="white-space:pre">SpringIOC—XmlBeanFactory</tspan></text></g><g ed:width="206" ed:parentid="175" ed:height="21" ed:layout="rightmap" id="102" transform="matrix(1,0,0,1,353,89)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.1.包装XML配置文件为Resource</tspan></text></g><g ed:width="243" ed:parentid="175" ed:height="21" ed:layout="rightmap" id="104" transform="matrix(1,0,0,1,353,189)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.加载配置文件—loadBeanDefinitions</tspan></text></g><g ed:width="197" ed:parentid="102" ed:height="21" ed:layout="rightmap" id="108" transform="matrix(1,0,0,1,586,89)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.1.1.ClassPathResource类包装</tspan></text></g><g ed:width="292" ed:parentid="104" ed:height="21" ed:layout="rightmap" id="110" transform="matrix(1,0,0,1,623,117)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.1.利用EncodingResource对资源文件编码处理</tspan></text></g><g ed:width="462" ed:parentid="104" ed:height="38" ed:layout="rightmap" id="112" transform="matrix(1,0,0,1,623,144)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.2.利用XmlBeanDefinitionReader的</tspan><tspan x="10" y="31.4" style="white-space:pre">loadBeanDefinitions(EncodedResource encodedResource)读取配置文件</tspan></text></g><g ed:width="603" ed:parentid="104" ed:height="21" ed:layout="rightmap" id="114" transform="matrix(1,0,0,1,623,189)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.3.通过一个ThreadLocal来记录正在加载的Resource资源，方便用于检测由&lt;import>引起的循环加载</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#c7254e; background-color:#f9f2f4;&quot;>XmlBeanDefinitionReader&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000; background-color:#ffffff;&quot;> 中 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#000000; background-color:#ffffff;&quot;>resourcesCurrentlyBeingLoaded&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000; background-color:#ffffff;&quot;> 的ThreadLocal用于记录当前正在被加载的Resource资源，key为ThreadLocal，value为Set&amp;lt;EncodedResource&amp;gt;。&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#000000; background-color:#ffffff;&quot;>用ThreadLocal表明多个线程加载同一资源是不受影响的，一个线程内不能循环加载。&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(577,4)"/></g></g><symbol id="note"><image height="16" width="16" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA4RpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDoyOTkwNTNiYS1iMTE3LWZiNDQtOTgwYy1mYjkwYzFiNzJlMWUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6QkYyRkU5OTU5Nzg0MTFFNzlFMjZFQTA0OUExMTI5NjAiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6QkYyRkU5OTQ5Nzg0MTFFNzlFMjZFQTA0OUExMTI5NjAiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MmY3M2I2ZDQtOWU4NC04ZDQ4LTk5NzItZDE3ODAwZjMyZDYzIiBzdFJlZjpkb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YzQ3Yzk0OWQtMGQ1Ny0xMWU3LTkzMmUtYzliNjJlYTc1ZTM1Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+K193vQAAAZpJREFUeNqkU0svA1EYPXe01UxV0npUSZTUBgtCk6Z2NmJj7R9YsKrHyiMRfoAtWxt/gWAhIkGaSEQqwdBWQrRlKp161PT6xijaejU9yZ17c+ee893z3e9jnHOUAoP2mZpbKkpltP+SEWDzzOoCGuanh/5FTqwunyvbFpdynwzZPIBQTOSHyA0eD9Xmpwhfp9H2YSGLncDRj2RvQxjcaEO61o7U8UlLmr0s0HZfjoCvqy2PxgD+AkTXwO73IKZOkRmYAI9eR+TtjfGCG2iJyYGqAPFNQN4FUhJgqoYYWzyz2O/61Iwi/WnBVx8ESwbJfJjINXQbFTMrne6xXkmy+g0oEOjpbn+b048JsNgqWCJAkS8A8g7BCN7op79rlAsTWLlQKKCzozDKW0Ay8BlZE2gaJpJTP6MVX0YvHSHfwvPVAXneJ3IIKHfQLiXRNUJr57evkyPgaW2EQUlBfagDyuw0RKBlEjDX/V7KWURjcZjlW9jsbvCKdjCHl05U/t0LWZitVRA7BiGIYnHN9N5Q/6/pL/XCSm3nVwEGAAA2iwis0BevAAAAAElFTkSuQmCC"/></symbol><g ed:width="261" ed:parentid="104" ed:height="21" ed:layout="rightmap" id="118" transform="matrix(1,0,0,1,623,216)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.4.从Resource中获取对应的InputStream</tspan></text></g><g ed:width="480" ed:parentid="104" ed:height="38" ed:layout="rightmap" id="120" transform="matrix(1,0,0,1,623,244)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.2.5.利用InputStream构造InputSource, InputSource是第三方org.xml.sax包下的，</tspan><tspan x="10" y="31.4" style="white-space:pre">接下来需要用SAX解析XML文件</tspan></text></g><g ed:width="262" ed:parentid="175" ed:height="21" ed:layout="rightmap" id="122" transform="matrix(1,0,0,1,353,329)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.加载配置文件—doLoadBeanDefinitions</tspan></text></g><g ed:width="370" ed:parentid="122" ed:height="21" ed:layout="rightmap" id="124" transform="matrix(1,0,0,1,642,343)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.2.根据包含Xml资源的InputSource获取SAX形式的Document</tspan></text></g><g ed:width="404" ed:parentid="122" ed:height="21" ed:layout="rightmap" id="126" transform="matrix(1,0,0,1,642,302)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.1.委托DocumentLoader对象的loadDocument方法获取Document</tspan></text></g><g ed:width="347" ed:parentid="126" ed:height="21" ed:layout="rightmap" id="128" transform="matrix(1,0,0,1,1073,288)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.1.1.创建EntityResolver给SAX，使其能读取本地DTD文件</tspan></text></g><g ed:width="342" ed:parentid="126" ed:height="21" ed:layout="rightmap" id="130" transform="matrix(1,0,0,1,1073,316)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.1.2.获取对XML配置文件的对应的验证模式(xsd/dtd)</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>委托XmlValidationModeDetector的detectValidationMode方法检测：通过查看xml文件是否含有'DOCTYPE'判断是否是DTD模式&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(316,4)"/></g></g><g ed:width="267" ed:parentid="122" ed:height="21" ed:layout="rightmap" id="132" transform="matrix(1,0,0,1,642,371)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.3.3.解析Document注册BeanDefinition信息</tspan></text></g><g ed:width="254" ed:parentid="175" ed:height="21" ed:layout="rightmap" id="134" transform="matrix(1,0,0,1,353,481)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.解析Document注册BeanDefinition</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'微软雅黑'; color:#2b3b50;&quot;>XmlBeanDefinitionReader委托&lt;/span>&lt;span style=&quot; font-family:'微软雅黑';&quot;>BeanDefinitionDocumentReader进行解析Document&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(228,4)"/></g></g><g ed:width="409" ed:parentid="134" ed:height="21" ed:layout="rightmap" id="136" transform="matrix(1,0,0,1,634,398)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.1.创建DefaultBeanDefinitionDocumentReader用于解析Document</tspan></text></g><g ed:width="669" ed:parentid="134" ed:height="21" ed:layout="rightmap" id="138" transform="matrix(1,0,0,1,634,426)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.2.创建XmlReaderContext对象，用于registerBeanDefinitions，以及包含了注册完成的监听器ReaderEventListener </tspan></text></g><g ed:width="376" ed:parentid="134" ed:height="21" ed:layout="rightmap" id="140" transform="matrix(1,0,0,1,634,453)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.3.提取Document的根标签root，也就是&lt;beans>...&lt;/beans></tspan></text></g><g ed:width="351" ed:parentid="134" ed:height="21" ed:layout="rightmap" id="142" transform="matrix(1,0,0,1,634,522)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.4.利用DefaultBeanDefinitionDocumentReader解析root</tspan></text></g><g ed:width="443" ed:parentid="142" ed:height="21" ed:layout="rightmap" id="144" transform="matrix(1,0,0,1,1012,481)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.4.1.处理&lt;beans>标签的profile属性，根据环境变量选择激活的profile加载</tspan></text></g><g ed:width="386" ed:parentid="142" ed:height="21" ed:layout="rightmap" id="146" transform="matrix(1,0,0,1,1012,508)"><path d="M0,0L386,0L386,21L0,21L0,0z" fill="#30c9f7"/><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.4.2.允许重写模板方法preProcessXml(root)，在解析前进行处理</tspan></text></g><g ed:width="392" ed:parentid="142" ed:height="21" ed:layout="rightmap" id="148" transform="matrix(1,0,0,1,1012,563)"><path d="M0,0L392,0L392,21L0,21L0,0z" fill="#30c9f7"/><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.4.4.允许重写模板方法postProcessXml(root)，在解析后进行处理</tspan></text></g><g ed:width="547" ed:parentid="142" ed:height="21" ed:layout="rightmap" id="150" transform="matrix(1,0,0,1,1012,536)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">1.4.4.3.逐个解析&lt;beans>中的子标签，包括</tspan><tspan class="st4" style="white-space:pre">默认和自定义标签</tspan><tspan style="white-space:pre">，注册到beanDefinitionMap中</tspan></text><g ed:hyperlink="[&#xa;    {&#xa;        &quot;desc&quot;: &quot;默认标签解析&quot;,&#xa;        &quot;link&quot;: &quot;https://wangguoping.blog.csdn.net/article/details/82259075&quot;&#xa;    },&#xa;    {&#xa;        &quot;desc&quot;: &quot;自定义标签解析&quot;,&#xa;        &quot;link&quot;: &quot;https://wangguoping.blog.csdn.net/article/details/82349946&quot;&#xa;    }&#xa;]&#xa;"><use xlink:href="#hyperlink" transform="translate(521,4)"/></g></g><symbol id="hyperlink"><image height="16" width="16" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTM4IDc5LjE1OTgyNCwgMjAxNi8wOS8xNC0wMTowOTowMSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6NTJGODZDMEQ5Nzg0MTFFN0E1QkQ5MTVGMzVENEU0NjUiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6NTJGODZDMEM5Nzg0MTFFN0E1QkQ5MTVGMzVENEU0NjUiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTcgKFdpbmRvd3MpIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MjQ3NTkzRDY0Q0RBMTFFN0E1OTFFREQ1OEEwMjU2QjQiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MjQ3NTkzRDc0Q0RBMTFFN0E1OTFFREQ1OEEwMjU2QjQiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz56C9ycAAAC/klEQVR42oxTa0iTYRR+3m/f7mnNSyOjqZWmCEWXlegyLy0wIoJIiKQoqB/9KIruU5yioBlEGV0lf1RgdKGCDE1zK+clSQO10pU6M811ma7UzX2XXgdBJljn/Hjh5TnPOTznOQSiCBcn7L5d8+HC2+9jKn24BjsSdGZ94bNcKcdA4MfxO0QCTMhkUHlEcEopWg4mgB3hhaN5TR9PN9gcCAhUoMn+HW++/DBbDiWxxuK6bPwj2JrmT3kNVe+xZ0MUMlbNR3OPC6Y77eC8YlblEQMxFj3NmomA6Xd7FCIrwfrYUAQoWKTSt2BbHF50fkXh43em2pMb8mYk0C8KhkizvPGj/6PbOQpOBA5vWoxnHV9wq7EvuzEnPZZIFCCMHITmFIL4RUG5+1Ii8KBlAKXWHnR/HUXO/Q50D41BF6pCfde3SZwe/kIybQJJtSrNUrJ9GeF4MbmszoGwOUqEB6vw6NUAJjgBSTEh0EcGXU2NnRtxLD2aXKnrcUnpiIJUgsH4BZDojLtx3WK3XNy1kvAgyTdsfRgZ92HUy4ETRMgpsKLtc+bDlsGdDEMOnMtYRvHd1ikEdNm4VuuwXNq1nGjU0uQ3A25EzwuEdrYcrb3D+DzswSwFg6p2J3iCZNoMpTaHdZKAJBY9B3xe8JwEooxF48m1UUNuj0EbqBgrrOgsr2kfwk8vjy0rwigJi5v1fdhjCMfelIVmqceXy/4tSmKBxS6Igt1mSsloc4wgLEiJpQvm4G5zPwq2xvmLy6y9kCpZsy9eB2aarIQuijBgCLEnxYSia+AnIkPUyNocA12werIz0unol6s/oN45amb+LuZlSvByFdacedmamajLX0eNVfy4E0pqtsVz1X5YJnUsoQK/bh0EO5PLUs+/yq7cv5wRBPGU6V4HCmiD1ZEa1L51+j0RolEMTxVRLqXXIaO+/ONYPGOoPGrIL3rSZapuG0IgvUI3XXNqnBbHN0bvZfEfkXa2PqvpRBIXq52V09zrwhJtwI+dhvAjxpKXpb8EGAC1AzS9LEFQkQAAAABJRU5ErkJggg=="/></symbol><g ed:width="191" ed:parentid="101" ed:height="36" ed:layout="rightmap" id="155" transform="matrix(1,0,0,1,78,851)"><path stroke="#96cdde" d="M0,0L191,0L191,36L0,36L0,0z" fill="#eff6f9" stroke-linejoin="round"/><text class="st5"><tspan x="19" y="22.4" style="white-space:pre">2.getBean()实例化</tspan></text><g ed:hyperlink="[&#xa;    {&#xa;        &quot;desc&quot;: &quot;bean加载&quot;,&#xa;        &quot;link&quot;: &quot;https://wangguoping.blog.csdn.net/article/details/82859993&quot;&#xa;    }&#xa;]&#xa;"><use xlink:href="#hyperlink" transform="translate(156,10)"/></g></g><g ed:width="544" ed:parentid="155" ed:height="21" ed:layout="rightmap" id="157" transform="matrix(1,0,0,1,296,597)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.1.提取对应的bean名称 (剥离工厂引用前缀；如果name是alias，则获取对应映射的beanName;)</tspan></text></g><g ed:width="307" ed:parentid="155" ed:height="21" ed:layout="rightmap" id="159" transform="matrix(1,0,0,1,296,666)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.2.getSington()尝试从三级缓存中加载单例bean</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>Spring容器中的三级缓存分别的作用：&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>1. 一级缓存缓存所有的单例，已经是最终形态；&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>2. 二级缓存缓存的是所有刚从三级缓存中getObject()返回的实例，还没有来得及属性设置等等，半成品；&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>3. 三级缓存缓存的是ObjectFactory实例，调用其getObject()才是我们想要的bean&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(281,4)"/></g></g><g ed:width="479" ed:parentid="155" ed:height="21" ed:layout="rightmap" id="161" transform="matrix(1,0,0,1,296,803)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.如果从缓存中获取到bean，需要对bean进行处理 (FactoryBean就是在这处理的）</tspan></text></g><g ed:width="287" ed:parentid="155" ed:height="21" ed:layout="rightmap" id="163" transform="matrix(1,0,0,1,296,1010)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.如果缓存中没有，则需要新建bean并加入缓存</tspan></text></g><g ed:width="598" ed:parentid="163" ed:height="21" ed:layout="rightmap" id="165" transform="matrix(1,0,0,1,610,900)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.1.多例模式下检查是否</tspan><tspan class="st4" style="white-space:pre">循环依赖</tspan><tspan style="white-space:pre">，因为Spring无法解决，主要利用ThreadLocal来记录正在加载多例bean</tspan></text></g><g ed:width="617" ed:parentid="163" ed:height="21" ed:layout="rightmap" id="167" transform="matrix(1,0,0,1,610,927)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.2.检测父容器parentBeanFactory，当前子容器没有对应的beanDefinition则可能需要进入父容器中getBean</tspan></text></g><g ed:width="225" ed:parentid="163" ed:height="21" ed:layout="rightmap" id="169" transform="matrix(1,0,0,1,610,1037)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.根据beanDefinition实例化bean</tspan></text></g><g ed:width="338" ed:parentid="169" ed:height="21" ed:layout="rightmap" id="171" transform="matrix(1,0,0,1,862,955)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.1.将GenericBeanDefinition转为RootBeanDefinition</tspan></text></g><g ed:width="510" ed:parentid="169" ed:height="21" ed:layout="rightmap" id="173" transform="matrix(1,0,0,1,862,982)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.2.先初始化depends-on标签属性定义的依赖bean (这里如果发生</tspan><tspan class="st4" style="white-space:pre">循环依赖</tspan><tspan style="white-space:pre">也无法解决)</tspan></text></g><g ed:width="305" ed:parentid="101" ed:height="36" ed:layout="rightmap" id="175" transform="matrix(1,0,0,1,21,319)"><path stroke="#96cdde" d="M0,0L305,0L305,36L0,36L0,0z" fill="#eff6f9" stroke-linejoin="round"/><text class="st5"><tspan x="19" y="22.4" style="white-space:pre">1.解析XML文件注册BeanDefinition</tspan></text><g ed:hyperlink="[&#xa;    {&#xa;        &quot;desc&quot;: &quot;容器的基本实现&quot;,&#xa;        &quot;link&quot;: &quot;https://wangguoping.blog.csdn.net/article/details/81235645&quot;&#xa;    }&#xa;]&#xa;"><use xlink:href="#hyperlink" transform="translate(270,10)"/></g></g><g ed:width="344" ed:parentid="169" ed:height="38" ed:layout="rightmap" id="177" transform="matrix(1,0,0,1,862,1029)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.3.依据scope创建bean，主要都是利用</tspan><tspan x="10" y="31.4" style="white-space:pre">ObjectFactory的getObject()中调用createBean方法</tspan></text></g><g ed:width="343" ed:parentid="169" ed:height="21" ed:layout="rightmap" id="179" transform="matrix(1,0,0,1,862,1120)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.5.对创建完的bean可能需要按照指定类型进行类型转换</tspan></text></g><g ed:width="609" ed:parentid="159" ed:height="21" ed:layout="rightmap" id="181" transform="matrix(1,0,0,1,630,625)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.2.1.检查一级缓存singletonObject&lt;beanName, bean>中是否存在实例，一级缓存是ConcurrentHashMap</tspan></text></g><g ed:width="654" ed:parentid="159" ed:height="21" ed:layout="rightmap" id="183" transform="matrix(1,0,0,1,630,652)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.2.2.尝试从二级缓存earlySingletonObjects中进行查找，查询二级缓存时会锁住一级缓存，所以二级缓存是HashMap</tspan></text></g><g ed:width="505" ed:parentid="159" ed:height="21" ed:layout="rightmap" id="185" transform="matrix(1,0,0,1,630,680)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.2.3.如果二级缓存中没有且允许早期依赖，则再尝试从三级缓存singletonFactories中查找</tspan></text></g><g ed:width="905" ed:parentid="159" ed:height="21" ed:layout="rightmap" id="187" transform="matrix(1,0,0,1,630,707)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.2.4.如果三级缓存singletonFactory中存在，调用预先设定的getObject方法获取到bean，并保存在二级缓存中，同时将三级缓存中删除（二级缓存与三级缓存互斥）</tspan></text></g><g ed:width="490" ed:parentid="161" ed:height="21" ed:layout="rightmap" id="189" transform="matrix(1,0,0,1,802,735)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.1.验证beanName是否以&amp;为前缀，如果是进一步验证bean是否是FactoryBean类型</tspan></text></g><g ed:width="366" ed:parentid="161" ed:height="21" ed:layout="rightmap" id="191" transform="matrix(1,0,0,1,802,762)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.2.如果包含前缀&amp;，则直接返回FactoryBean类型的bean即可</tspan></text></g><g ed:width="373" ed:parentid="161" ed:height="21" ed:layout="rightmap" id="193" transform="matrix(1,0,0,1,802,831)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.3.否则需要返回FactoryBean中getObject()方法中定义的bean</tspan></text></g><g ed:width="418" ed:parentid="193" ed:height="21" ed:layout="rightmap" id="195" transform="matrix(1,0,0,1,1202,790)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.3.1.尝试从factoryBeanObjectCache&lt;beanName, bean>缓存中获取</tspan></text></g><g ed:width="288" ed:parentid="193" ed:height="21" ed:layout="rightmap" id="197" transform="matrix(1,0,0,1,1202,817)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.3.2.获取不到则进行getObject()方法返回bean</tspan></text></g><g ed:width="394" ed:parentid="193" ed:height="21" ed:layout="rightmap" id="199" transform="matrix(1,0,0,1,1202,872)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.3.4.存储在factoryBeanObjectCache&lt;beanName, bean>缓存中</tspan></text></g><g ed:width="244" ed:parentid="193" ed:height="21" ed:layout="rightmap" id="202" transform="matrix(1,0,0,1,1202,845)"><text class="st3"><tspan x="10" y="14.4" style="white-space:pre">2.3.3.3.对返回的bean进行后处理操作</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>查看子类 AbstractAutowireCapableBeanFactory 的 postProcessObjectFromFactoryBean(object, beanName) 方法：&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * FactoryBean调用getObject()产生的bean的后处理操作&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * Applies the {&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@code&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> postProcessAfterInitialization} callback of all&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * registered BeanPostProcessors, giving them a chance to post-process the&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * object obtained from FactoryBeans (for example, to auto-proxy them).&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@see&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> #applyBeanPostProcessorsAfterInitialization&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Override&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>protected&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>postProcessObjectFromFactoryBean&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>(Object object, String beanName)&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> applyBeanPostProcessorsAfterInitialization(object, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> existingBean the new bean instance FactoryBean的getObject获得的对象&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean 处理后的bean name&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> BeansException&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Override&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>public&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>applyBeanPostProcessorsAfterInitialization&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>(Object existingBean, String beanName)&lt;br />&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> BeansException &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    Object result = existingBean;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>for&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (BeanPostProcessor beanProcessor : getBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        Object current = beanProcessor.postProcessAfterInitialization(result, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (current == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        result = current;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(218,4)"/></g></g><g ed:width="391" ed:parentid="177" ed:height="21" ed:layout="rightmap" id="204" transform="matrix(1,0,0,1,1233,1010)"><text class="st3"><tspan x="9" y="14.4" style="white-space:pre">如果是多例模式，直接创建即可createBean(beanName, mbd, args)</tspan></text></g><g ed:width="412" ed:parentid="177" ed:height="21" ed:layout="rightmap" id="206" transform="matrix(1,0,0,1,1233,1037)"><text class="st3"><tspan x="9" y="14.4" style="white-space:pre">如果是单例模式，再次判断一级缓存是否为空，然后再决定是否实例化</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>Spring如何保证创建的bean唯一？&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>1. FactoryBean多次查看缓存&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>2. 三级缓存的查询机制，如果没有时，先锁住一级缓存，然后进行创建需要先再次查询一级缓存，还没有才创建&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(386,4)"/></g></g><g ed:width="419" ed:parentid="177" ed:height="21" ed:layout="rightmap" id="208" transform="matrix(1,0,0,1,1233,1065)"><text class="st3"><tspan x="9" y="14.4" style="white-space:pre">如果是其他模式，则通过ObjectFactory配合Scope的get()方法来创建bean</tspan></text></g><g ed:topictype="floating" ed:width="290" ed:height="36" ed:layout="rightmap" id="210" transform="matrix(1,0,0,1,87,1474)"><path stroke="#82cada" d="M0,0L290,0L290,36L0,36L0,0z" fill="#cde7ed" stroke-linejoin="round"/><text class="st5"><tspan x="18" y="22.4" style="white-space:pre">createBean(beanName, mbd, args)</tspan></text></g><g ed:width="525" ed:parentid="233" ed:height="22.5" id="211" transform="matrix(1,0,0,1,617,1260)"><path stroke="#96cdde" d="M0,22.5L525,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">如果是单例，先尝试取出factoryBeanInstanceCache&lt;beanName，BeanWrapper>中的缓存</tspan></text></g><g ed:width="500" ed:parentid="233" ed:height="22.5" id="215" transform="matrix(1,0,0,1,617,1333)"><path stroke="#96cdde" d="M0,22.5L500,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">如果factoryBeanInstanceCache没有缓存对应的BeanWrapper，需要创建BeanWrapper</tspan></text></g><g ed:width="192" ed:parentid="215" ed:height="22.5" id="219" transform="matrix(1,0,0,1,1144,1289)"><path stroke="#96cdde" d="M0,22.5L192,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">解析beanDefinition的Class类型</tspan></text></g><g ed:width="447" ed:parentid="215" ed:height="22.5" id="221" transform="matrix(1,0,0,1,1144,1318)"><path d="M0,0L447,0L447,22.5L0,22.5L0,0z" fill="#30c9f7"/><path stroke="#96cdde" d="M0,22.5L447,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">寻找和参数对应的构造函数（会先从缓存中查找，没有则解析并保存至缓存）</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>确定构造函数，添加缓存&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// Shortcut when re-creating the same bean...&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>boolean&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> resolved = &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>false&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>boolean&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> autowireNecessary = &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>false&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 一个类有多个构造函数，每个构造函数都有不同的参数，所以调用前需要先根据参数锁定构造函数和对应的工厂方法&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (args == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>synchronized&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (mbd.constructorArgumentLock) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// Executable resolvedConstructorOrFactoryMethod缓存解析好的构造函数或工厂方法（Executable两个子类——Method和Constructor）&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (mbd.resolvedConstructorOrFactoryMethod != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            resolved = &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>true&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            autowireNecessary = mbd.constructorArgumentsResolved;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 如果已经解析过则使用缓存中已经解析好的构造函数方法不需要再次锁定&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (resolved) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (autowireNecessary) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 构造函数自动注入&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> autowireConstructor(beanName, mbd, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>else&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 使用默认构造函数构造&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> instantiateBean(beanName, mbd);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 需要根据参数解析构造函数...&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>Constructor&amp;lt;?&amp;gt;[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (ctors != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> ||&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        mbd.getResolvedAutowireMode() == RootBeanDefinition.AUTOWIRE_CONSTRUCTOR ||&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args))  {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 构造函数自动注入&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> autowireConstructor(beanName, mbd, ctors, args);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 没有特殊则使用默认构造函数构造&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> instantiateBean(beanName, mbd);&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>通过&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>InstantiationAwareBeanPostProcessors&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>类型的bean后处理器，调用后处理器中的&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>determineCandidateConstructors()&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>方法确定构造方法&lt;/span>&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 通过bean的后处理器确定要用于给定bean的候选构造函数，检查所有已注册的构造函数&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * {&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@link&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> SmartInstantiationAwareBeanPostProcessor SmartInstantiationAwareBeanPostProcessors}.&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanClass the raw class of the bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> the candidate constructors, or {&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@code&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> null} if none specified&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> org.springframework.beans.BeansException in case of errors&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@see&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor#determineCandidateConstructors&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Nullable&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>protected&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> Constructor&amp;lt;?&amp;gt;[] determineConstructorsFromBeanPostProcessors(&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Nullable&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> Class&amp;lt;?&amp;gt; beanClass, String beanName)&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeansException {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (beanClass != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &amp;amp;&amp;amp; hasInstantiationAwareBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>for&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (BeanPostProcessor bp : getBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bp &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> SmartInstantiationAwareBeanPostProcessor) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                Constructor&amp;lt;?&amp;gt;[] ctors = ibp.determineCandidateConstructors(beanClass, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (ctors != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> ctors;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(421,3)"/></g></g><g ed:width="429" ed:parentid="210" ed:height="22.5" id="223" transform="matrix(1,0,0,1,404,1173)"><path stroke="#96cdde" d="M0,22.5L429,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">设置beanDefinition对应的Class类型或者根据className来反射出Class类型</tspan></text></g><g ed:width="235" ed:parentid="210" ed:height="22.5" id="225" transform="matrix(1,0,0,1,404,1202)"><path stroke="#96cdde" d="M0,22.5L235,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">对MethodOverride属性进行验证及标记</tspan></text></g><g ed:width="485" ed:parentid="210" ed:height="22.5" id="231" transform="matrix(1,0,0,1,404,1231)"><path d="M0,0L485,0L485,22.5L0,22.5L0,0z" fill="#30c9f7"/><path stroke="#96cdde" d="M0,22.5L485,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">应用初始化前的bean后处理器，解析指定bean是否存在应用初始化前的短路操作 (AOP)</tspan></text></g><g ed:width="186" ed:parentid="210" ed:height="22.5" id="233" transform="matrix(1,0,0,1,404,1524)"><path stroke="#96cdde" d="M0,22.5L186,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">doCreateBean()常规创建bean</tspan></text></g><g ed:width="523" ed:parentid="233" ed:height="22.5" id="235" transform="matrix(1,0,0,1,617,1405)"><path stroke="#96cdde" d="M0,22.5L523,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">通过前两步，我们得到BeanWrapper后，进行MergedBeanDefinitionPostProcessors的应用</tspan></text></g><g ed:width="322" ed:parentid="233" ed:height="22.5" id="237" transform="matrix(1,0,0,1,617,1434)"><path stroke="#96cdde" d="M0,22.5L322,22.5" fill="none" stroke-linejoin="round"/><text class="st6"><tspan x="8" class="st7" y="14.1" style="white-space:pre">创建ObjectFactory对象，添加到bean的第三级缓存</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>earlySingletonExposure 就是为了解决循环依赖而准备的。它由三部分组成，首先是是否单例模式 mbd.isSingleton()，其次是是否允许循环依赖 this.allowCircularReferences 以及 bean 是否正在创建中 isSingletonCurrentlyInCreation(beanName) 。当这三个条件都满足时，会执行 addSingletonFactory() 方法&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>addSingletonFactory(beanName,&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 对bean再一次依赖引用，主要应用SmartInstantiationAwareBeanPostProcessor&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 其中我们熟知的AOP就是这样将advice动态织入bean中，若没有则直接返回bean，不做任何处理&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    () -&amp;gt; getEarlyBeanReference(beanName, mbd, bean));&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体'; color:#383a42;&quot;>&lt;br />&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体'; color:#383a42;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * Obtain a reference for early access to the specified bean,&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * typically for the purpose of resolving a circular reference.&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean (for error handling purposes)&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> mbd the merged bean definition for the bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> bean the raw bean instance&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> the object to expose as bean reference&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>protected&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>getEarlyBeanReference&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>(String beanName, RootBeanDefinition mbd, Object bean)&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 提早暴露的bean，此时的bean刚刚利用构造器进行构造完毕，还没有设置属性&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        Object exposedObject = bean;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 允许利用bean的InstantiationAwareBeanPostProcessors类型后处理器调用getEarlyBeanReference方法对提早暴露的bean进行处理&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (!mbd.isSynthetic() &amp;amp;&amp;amp; hasInstantiationAwareBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>for&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (BeanPostProcessor bp : getBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bp &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> SmartInstantiationAwareBeanPostProcessor) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    SmartInstantiationAwareBeanPostProcessor ibp = (SmartInstantiationAwareBeanPostProcessor) bp;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    exposedObject = ibp.getEarlyBeanReference(exposedObject, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 返回需要提早暴露的bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(296,3)"/></g></g><g ed:width="448" ed:parentid="233" ed:height="22.5" id="239" transform="matrix(1,0,0,1,617,1524)"><path stroke="#96cdde" d="M0,22.5L448,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">利用populateBean(beanName, mbd, instanceWrapper)对bean进行属性填充</tspan></text></g><g ed:width="487" ed:parentid="233" ed:height="22.5" id="241" transform="matrix(1,0,0,1,617,1729)"><path stroke="#96cdde" d="M0,22.5L487,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">循环依赖检查，检测已经加载的 bean 是否已经出现了依赖循环，并判断是否要抛出异常</tspan></text></g><g ed:width="306" ed:parentid="233" ed:height="22.5" id="243" transform="matrix(1,0,0,1,617,1758)"><path stroke="#96cdde" d="M0,22.5L306,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">注册DisposableBean，便于销毁bean的时候调用</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;>Spring中不仅提供了对于初始化方法的扩展入口，同样也提供了销毁方法的扩展入口。除了 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-style:italic; color:#4f4f4f; background-color:#ffffff;&quot;>destroy-method&lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;> 之外，还可以注册后处理器 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#c7254e; background-color:#f9f2f4;&quot;>DestructionAwareBeanPostProcessor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;> 来统一处理 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; font-style:italic; color:#4f4f4f; background-color:#ffffff;&quot;>bean&lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;> 的销毁方法。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(280,3)"/></g></g><g ed:width="102" ed:parentid="233" ed:height="22.5" id="246" transform="matrix(1,0,0,1,617,1787)"><path stroke="#96cdde" d="M0,22.5L102,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">完成创建并返回</tspan></text></g><g ed:width="276" ed:parentid="215" ed:height="22.5" id="248" transform="matrix(1,0,0,1,1144,1347)"><path stroke="#96cdde" d="M0,22.5L276,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">利用autowireConstructor()方法进行有参实例化</tspan></text></g><g ed:width="267" ed:parentid="215" ed:height="22.5" id="250" transform="matrix(1,0,0,1,1144,1376)"><path stroke="#96cdde" d="M0,22.5L267,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">利用instantiateBean()方法进行无参实例化</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体';&quot;>实例化时会判断如何进行实例化，是否需要CGlib动态代理生成子类（&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4f4f4f; background-color:#ffffff;&quot;>用户在配置文件中配置 &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#4f4f4f; background-color:#ffffff;&quot;>replace&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4f4f4f; background-color:#ffffff;&quot;> 或者 &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#4f4f4f; background-color:#ffffff;&quot;>lookup&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4f4f4f; background-color:#ffffff;&quot;> 的配置方法&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>）&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 无参实例化策略&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> bd the bean definition&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean when it's created in this context.&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * The name can be {&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@code&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> null} if we're autowiring a bean which doesn't belong to the factory.&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> owner the owning BeanFactory&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Override&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>public&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>instantiate&lt;/span>&lt;span style=&quot; font-family:'宋体';&quot;>(RootBeanDefinition bd, @Nullable String beanName, BeanFactory owner)&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 如果有需要覆盖或者动态替换的方法当然需要使用cglib进行动态代理，因为可以在创建代理的同时将动态方法织入类中&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 但是如果没有需要动态改变的方法，为了方便直接反射就可以了&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (!bd.hasMethodOverrides()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        Constructor&amp;lt;?&amp;gt; constructorToUse;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>synchronized&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bd.constructorArgumentLock) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 再次尝试获取缓存，确认是否拥有&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            constructorToUse = (Constructor&amp;lt;?&amp;gt;) bd.resolvedConstructorOrFactoryMethod;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (constructorToUse == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>final&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> Class&amp;lt;?&amp;gt; clazz = bd.getBeanClass();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (clazz.isInterface()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throw&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>new&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanInstantiationException(clazz, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;Specified class is an interface&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>try&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (System.getSecurityManager() != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                        constructorToUse = AccessController.doPrivileged(&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                                (PrivilegedExceptionAction&amp;lt;Constructor&amp;lt;?&amp;gt;&amp;gt;) clazz::getDeclaredConstructor);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>else&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 获取指定参数类型的构造函数，这里是无参构造函数&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                        constructorToUse =  clazz.getDeclaredConstructor();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 添加进入缓存，便于下次直接使用，不再解析&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    bd.resolvedConstructorOrFactoryMethod = constructorToUse;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>catch&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (Throwable ex) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throw&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>new&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanInstantiationException(clazz, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;No default constructor found&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>, ex);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanUtils.instantiateClass(constructorToUse);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>else&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 利用Cglib进行动态代理生成子类&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> instantiateWithMethodInjection(bd, beanName, owner);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(241,3)"/></g></g><g ed:width="479" ed:parentid="233" ed:height="22.5" id="252" transform="matrix(1,0,0,1,617,1657)"><path stroke="#96cdde" d="M0,22.5L479,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">调用initializeBean(beanName, exposedObject, mbd)初始化方法对bean进行初始化</tspan></text></g><g ed:width="500" ed:parentid="239" ed:height="22.5" id="254" transform="matrix(1,0,0,1,1092,1463)"><path stroke="#96cdde" d="M0,22.5L500,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">给InstantiationAwareBeanPostProcessors后处理器最后一次机会在属性设置前改变bean</tspan></text></g><g ed:width="535" ed:parentid="239" ed:height="39.5" id="256" transform="matrix(1,0,0,1,1092,1492)"><path stroke="#96cdde" d="M0,39.5L535,39.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">如果处理器允许继续属性填充，根据注入类型 (byName/byType) 提取依赖的 bean，并统一</tspan><tspan x="8" y="31.1" style="white-space:pre">存入PropertyValues 中</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#cccccc; background-color:#2d2d2d;&quot;>MutablePropertyValues 能够添加 PropertyValue，每一个PropertyValue表示一个依赖，PropertyValue中封装了依赖bean的beanName，以及bean实例的name-value映射&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(509,12)"/></g></g><g ed:width="514" ed:parentid="239" ed:height="39.5" id="258" transform="matrix(1,0,0,1,1092,1538)"><path stroke="#96cdde" d="M0,39.5L514,39.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">应用 InstantiationAwareBeanPostProcessor 的 postProcessPropertyValues() 方法，对</tspan><tspan x="8" y="31.1" style="white-space:pre">属性获取完毕填充前的再次处理</tspan></text></g><g ed:width="440" ed:parentid="239" ed:height="22.5" id="260" transform="matrix(1,0,0,1,1092,1584)"><path stroke="#96cdde" d="M0,22.5L440,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">将所有ProtertyValues中的属性添加至BeanWrapper中，并注入bean的依赖值</tspan></text></g><g ed:width="123" ed:parentid="252" ed:height="22.5" id="262" transform="matrix(1,0,0,1,1123,1613)"><path stroke="#96cdde" d="M0,22.5L123,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">激活Aware方法</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 对特殊的bean的处理：BeanNameAware、BeanClassLoaderAware、BeanFactoryAware&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>invokeAwareMethods(beanName, bean);&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体'; color:#383a42;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 对三种Aware调用了setter方法，给bean传入对应的东西&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>private&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>void&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>invokeAwareMethods&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;>(&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>final&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;> String beanName, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>final&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;> Object bean)&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bean &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> Aware) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bean &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanNameAware) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            ((BeanNameAware) bean).setBeanName(beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bean &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanClassLoaderAware) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            ClassLoader bcl = getBeanClassLoader();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bcl != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>                ((BeanClassLoaderAware) bean).setBeanClassLoader(bcl);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (bean &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> BeanFactoryAware) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            ((BeanFactoryAware) bean).setBeanFactory(AbstractAutowireCapableBeanFactory.&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>this&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(97,3)"/></g></g><g ed:width="284" ed:parentid="252" ed:height="22.5" id="264" transform="matrix(1,0,0,1,1123,1642)"><path d="M0,0L284,0L284,22.5L0,22.5L0,0z" fill="#30c9f7"/><path stroke="#96cdde" d="M0,22.5L284,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">应用bean的自定义初始化后处理器的前置处理</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;>调用用户自定义初始化方法前调用 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#c7254e; background-color:#f9f2f4;&quot;>BeanPostProcessor&lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;> 的 &lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#c7254e; background-color:#f9f2f4;&quot;>postProcessBeforeInitialization&lt;/span>&lt;span style=&quot; font-family:'Consolas'; color:#4f4f4f; background-color:#ffffff;&quot;> &lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体'; color:#383a42;&quot;>&lt;br />&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'宋体'; color:#383a42;&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 初始化前应用BeanPostProcessors后处理器&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> existingBean the new bean instance&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> BeansException&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Override&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>public&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>applyBeanPostProcessorsBeforeInitialization&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;>(Object existingBean, String beanName)&lt;br />&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> BeansException &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   Object result = existingBean;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>for&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (BeanPostProcessor beanProcessor : getBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      Object current = beanProcessor.postProcessBeforeInitialization(result, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (current == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      result = current;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(258,3)"/></g></g><g ed:width="176" ed:parentid="252" ed:height="22.5" id="266" transform="matrix(1,0,0,1,1123,1671)"><path stroke="#96cdde" d="M0,22.5L176,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">激活用户自定义的init方法</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas';&quot;>用户定制的初始化方法除了我们熟知的使用配置 init-method 外，还可以通过让自定义的 bean 实现 InitializingBean 接口，并在 afterPropertiesSet 中实现自己的初始化业务逻辑。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'Consolas';&quot;>init-method 与 afterPropertiesSet 都是在初始化 bean 时执行，执行顺序是 afterPropertiesSet 先执行，而 init-method 后执行。&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas';&quot;>&lt;br />&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Consolas';&quot;>&lt;br />&lt;/p>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 激活用户自定义初始化方法&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * Give a bean a chance to react now all its properties are set,&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * and a chance to know about its owning bean factory (this object).&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * This means checking whether the bean implements InitializingBean or defines&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * a custom init method, and invoking the necessary callback(s) if it does.&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the bean name in the factory (for debugging purposes)&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> bean the new bean instance we may need to initialize&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> mbd the merged bean definition that the bean was created with&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * (can also be {&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@code&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> null}, if given an existing bean instance)&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> Throwable if thrown by init methods or by the invocation process&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@see&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> #invokeCustomInitMethod&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>protected&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>void&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>invokeInitMethods&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;>(String beanName, &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>final&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;> Object bean, @Nullable RootBeanDefinition mbd)&lt;br />&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Throwable &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 首先检查bean是否是InitializingBean实例，是的话需要先调用afterPropertiesSet方法&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>boolean&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> isInitializingBean = (bean &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>instanceof&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> InitializingBean);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (isInitializingBean &amp;amp;&amp;amp; (mbd == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> || !mbd.isExternallyManagedInitMethod(&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;afterPropertiesSet&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>))) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (logger.isDebugEnabled()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         logger.debug(&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;Invoking afterPropertiesSet() on bean with name '&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> + beanName + &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;'&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (System.getSecurityManager() != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>try&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            AccessController.doPrivileged((PrivilegedExceptionAction&amp;lt;Object&amp;gt;) () -&amp;gt; {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>               ((InitializingBean) bean).afterPropertiesSet();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>               &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            }, getAccessControlContext());&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>catch&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (PrivilegedActionException pae) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throw&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> pae.getException();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>else&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 属性初始化后的处理&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         ((InitializingBean) bean).afterPropertiesSet();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (mbd != &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> &amp;amp;&amp;amp; bean.getClass() != NullBean.class) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      String initMethodName = mbd.getInitMethodName();&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (StringUtils.hasLength(initMethodName) &amp;amp;&amp;amp;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            !(isInitializingBean &amp;amp;&amp;amp; &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#50a14f;&quot;>&amp;quot;afterPropertiesSet&amp;quot;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>.equals(initMethodName)) &amp;amp;&amp;amp;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            !mbd.isExternallyManagedInitMethod(initMethodName)) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>// 调用自定义初始化方法&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>         invokeCustomInitMethod(beanName, bean, mbd);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>      }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>   }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;p style=&quot;-qt-paragraph-type:empty; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px;  font-family:'Arial';&quot;>&lt;br />&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(150,3)"/></g></g><g ed:width="284" ed:parentid="252" ed:height="22.5" id="268" transform="matrix(1,0,0,1,1123,1700)"><path stroke="#96cdde" d="M0,22.5L284,22.5" fill="none" stroke-linejoin="round"/><text class="st3"><tspan x="8" y="14.1" style="white-space:pre">应用bean的自定义初始化后处理器的后置处理</tspan></text><g ed:note="&lt;body style=&quot; font-family:'SimSun'; font-size:9pt; font-weight:400; font-style:normal;&quot;>&lt;p style=&quot; margin-top:0px; margin-bottom:0px; margin-left:0px; margin-right:0px; -qt-block-indent:0; text-indent:0px; &quot;>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;>/**&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * 初始化后应用BeanPostProcessors后处理器&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> existingBean the new bean instance FactoryBean的getObject获得的对象&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@param&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> beanName the name of the bean 处理后的bean name&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@return&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> * &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a626a4;&quot;>@throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> BeansException&lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#000000;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; font-style:italic; color:#a0a1a7;&quot;> */&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>@Override&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>public&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> Object &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#4078f2;&quot;>applyBeanPostProcessorsAfterInitialization&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#000000;&quot;>(Object existingBean, String beanName)&lt;br />&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>throws&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> BeansException &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>{&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;>  &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    Object result = existingBean;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>for&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (BeanPostProcessor beanProcessor : getBeanPostProcessors()) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        Object current = beanProcessor.postProcessAfterInitialization(result, beanName);&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>if&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> (current == &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>null&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>) {&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>            &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>        result = current;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    }&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>    &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#a626a4;&quot;>return&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;> result;&lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42;&quot;> &lt;/span>&lt;span style=&quot; font-family:'宋体'; color:#383a42; background-color:#fafafa;&quot;>}&lt;/span>&lt;/p>&lt;/body>"><use xlink:href="#note" transform="translate(258,3)"/></g></g><g ed:width="479" ed:parentid="169" ed:height="21" ed:layout="rightmap" id="270" transform="matrix(1,0,0,1,862,1092)"><path d="M0,0L479,0L479,21L0,21L0,0z" fill="#ffffff"/><text class="st6"><tspan x="10" y="14.4" style="white-space:pre">2.4.3.4.</tspan><tspan class="st8" style="white-space:pre">将bean</tspan><tspan class="st7" style="white-space:pre">添加一级缓存并删除二级缓存和三级缓存</tspan><tspan class="st8" style="white-space:pre">，记录已经加载的beanName</tspan></text></g><symbol id="plus"><path d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6z" fill="url(#lg1)"/><path stroke="#46a000" d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6zM3,6L9,6M6,3L6,9" fill="none" stroke-width="0.7"/></symbol><symbol id="minus"><path d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6z" fill="url(#lg1)"/><path stroke="#46a000" d="M11,6C11,8.8,8.8,11,6,11C3.2,11,1,8.8,1,6C1,3.2,3.2,1,6,1C8.8,1,11,3.2,11,6zM3,6L9,6" fill="none" stroke-width="0.7"/></symbol><g ed:togtopicid="101" transform="translate(168,77)"><use xlink:href="#minus"/></g><g ed:togtopicid="102" transform="translate(560,94)"><use xlink:href="#minus"/></g><g ed:togtopicid="104" transform="translate(597,193)"><use xlink:href="#minus"/></g><g ed:togtopicid="122" transform="translate(616,334)"><use xlink:href="#minus"/></g><g ed:togtopicid="126" transform="translate(1047,306)"><use xlink:href="#minus"/></g><g ed:togtopicid="134" transform="translate(608,485)"><use xlink:href="#minus"/></g><g ed:togtopicid="142" transform="translate(986,526)"><use xlink:href="#minus"/></g><g ed:togtopicid="155" transform="translate(270,863)"><use xlink:href="#minus"/></g><g ed:togtopicid="159" transform="translate(604,670)"><use xlink:href="#minus"/></g><g ed:togtopicid="161" transform="translate(776,808)"><use xlink:href="#minus"/></g><g ed:togtopicid="163" transform="translate(584,1014)"><use xlink:href="#minus"/></g><g ed:togtopicid="169" transform="translate(836,1042)"><use xlink:href="#minus"/></g><g ed:togtopicid="175" transform="translate(327,331)"><use xlink:href="#minus"/></g><g ed:togtopicid="177" transform="translate(1207,1042)"><use xlink:href="#minus"/></g><g ed:togtopicid="193" transform="translate(1176,835)"><use xlink:href="#minus"/></g><g ed:togtopicid="210" transform="translate(378,1486)"><use xlink:href="#minus"/></g><g ed:togtopicid="215" transform="translate(1118,1338)"><use xlink:href="#minus"/></g><g ed:togtopicid="233" transform="translate(591,1529)"><use xlink:href="#minus"/></g><g ed:togtopicid="239" transform="translate(1066,1529)"><use xlink:href="#minus"/></g><g ed:togtopicid="252" transform="translate(1097,1662)"><use xlink:href="#minus"/></g></svg>